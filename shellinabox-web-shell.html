<!DOCTYPE html>
<html lang="en">
<head>
          <title>War Against Computers</title>
        <meta charset="utf-8" />
        <link href="alexcreek.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="War Against Computers Full Atom Feed" />
        <link href="alexcreek.com/feeds/system-administration.atom.xml" type="application/atom+xml" rel="alternate" title="War Against Computers Categories Atom Feed" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="../../favicon.ico">





    <!-- Google web fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,900' rel='stylesheet' type='text/css'>

    <!-- Bootstrap core CSS -->
    <link href="./theme/css/bootstrap.min.css" rel="stylesheet"> 

    <!-- Custom styles for this template -->
    <link href="./theme/css/starter-template.css" rel="stylesheet"> 
    
    <!-- Search CSS -->
    <link rel="stylesheet" href="./theme/tipuesearch/tipuesearch.css"> 
</head>

 <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="./category/code.html">Code</a></li>
                    <li><a href="./category/networking.html">Networking</a></li>
                    <li class="active"><a href="./category/system-administration.html">System Administration</a></li>
          </ul>
<!--                <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
                    <div class="form-group">
                        <input class="form-control" id="searchbox" type="text" name="q" size="12" placeholder="Search">
                    </div>
                </form> -->
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
<body id="index" class="home">
        <header id="banner" class="body">
                <h1 class="header"><a href="./">War Against Computers <strong></strong></a></h1>
        </header><!-- /#banner -->

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./shellinabox-web-shell.html" rel="bookmark"
         title="Permalink to Shellinabox Web Shell">Shellinabox Web Shell</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-10-29T00:00:00-04:00">
      Wed 29 October 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/alex.html">alex</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Shellinabox is a browser based, login shell, built using css, html and javascript and it runs entirely over HTTP.  At a high level, shellinabox is very similar to an SSH shell session.  They both utilize the <code>/etc/passwd</code> user database, they both make use of <code>PAM</code>, and they both execute <code>/bin/login</code> to authenticate users.  The primary difference is that shellinabox communicates exclusivly over HTTP and HTTPS, not SSH. </p>
<p>Basically, <code>shellinabox</code> is a webserver that allows users to authenticate against a system and then renders the terminal output in html and css.</p>
<h2>Install</h2>
<p>It can be installed from source from <a href="shellinabox.com">shellinabox.com</a> or if you're using Ubuntu 14.04, it's available from the <code>Universe</code> repo. </p>
<div class="highlight"><pre>apt-get install shellinabox
</pre></div>


<p>It's recommended to implement additional layers of security by putting a reverse proxy in front of <code>shellinabox</code>, encrypting the connection and requiring HTTP authentication.  We'll use <code>apache</code> for this.</p>
<div class="highlight"><pre>apt-get install apache2 apache2-utils
</pre></div>


<h2>Configure</h2>
<p>We'll enable a couple modules we need</p>
<div class="highlight"><pre>a2enmod ssl proxy proxy_http auth_digest
service apache2 restart
</pre></div>


<p>Next we'll configure the <code>htpasswd</code> file and create self signed SSL certificates</p>
<div class="highlight"><pre>mkdir -p /etc/apache2/auth
htdigest -c /etc/apache2/auth/shell_users &quot;Authorization Required&quot; alex

mkdir -p /etc/apache2/ssl
openssl req -x509 -nodes -days 730 -newkey rsa:2048 -keyout /etc/apache2/ssl/shell.pem -out /etc/apache2/ssl/shell.pem
</pre></div>


<p>Now we'll install the <code>apache</code> vhost config and restart <code>apache</code> to make the changes take effect</p>
<div class="highlight"><pre><span class="nt">&lt;VirtualHost</span> <span class="err">*:443</span><span class="nt">&gt;</span>
        ErrorLog <span class="cp">${</span><span class="n">APACHE_LOG_DIR</span><span class="cp">}</span>/shell-error.log
        CustomLog <span class="cp">${</span><span class="n">APACHE_LOG_DIR</span><span class="cp">}</span>/shell-access.log combined

        # Auth
        <span class="nt">&lt;Location</span> <span class="nt">/&gt;</span>
                AuthType digest
                AuthName &quot;Authorization Required&quot;
                AuthDigestProvider file
                AuthUserFile /etc/apache2/auth/shell_users
                Require valid-user
                Options -Indexes
        <span class="nt">&lt;/Location&gt;</span>

        <span class="nt">&lt;Directory</span> <span class="err">~</span> <span class="err">&quot;\.git&quot;</span><span class="nt">&gt;</span>
                Order allow,deny
                Deny from all
        <span class="nt">&lt;/Directory&gt;</span>

        # Reverse Proxy
        ProxyPass        /shellinabox  http://localhost:4200/
        ProxyPassReverse /shellinabox  http://localhost:4200/

        # SSL 
        SSLEngine on
        SSLCertificateFile      /etc/apache2/ssl/shell.pem
        SSLCertificateKeyFile   /etc/apache2/ssl/shell.key
        SSLHonorCipherOrder on
        SSLProtocol all -SSLv2 -SSLv3
        SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>


<div class="highlight"><pre>service apache2 restart
</pre></div>


<p>By default, <code>shellinabox</code> uses HTTPS.  Because we're putting it behind a proxy and using our own webserver to implement TLS, we'll disable it's built-in encryption as well as force it to listen on the local loopback interface.</p>
<div class="highlight"><pre>vi /etc/default/shellinabox
# Modify
SHELLINABOX_ARGS=&quot;--no-beep --disable-ssl --localhost-only&quot;
</pre></div>


<div class="highlight"><pre>service shellinabox restart
</pre></div>


<p></br>
If everything is working correctly, you should now be able to browse to https://[server_ip]/shellinabox and be greeted with a familar looking prompt, wating for a username and password.</p>
<p><img alt="It works" src="images/shell.gif" title="It Works" /></p>
  </div><!-- /.entry-content -->
</section>
    </div>

<script type="text/javascript">
    var disqus_shortname = 'alexcreekcom';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
        
        <footer id="contentinfo" class="container">
                <address id="about" class="vcard body">
                </br>Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="./theme/js/bootstrap.min.js"></script>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-56063544-1");
pageTracker._trackPageview();
} catch(err) {}</script>

    
</body>
</html>
