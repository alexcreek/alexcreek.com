<!DOCTYPE html>
<html lang="en">
<head>
          <title>War Against Computers</title>
        <meta charset="utf-8" />
        <link href="alexcreek.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="War Against Computers Full Atom Feed" />
        <link href="alexcreek.com/feeds/system-administration.atom.xml" type="application/atom+xml" rel="alternate" title="War Against Computers Categories Atom Feed" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="../../favicon.ico">





    <!-- Google web fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,900' rel='stylesheet' type='text/css'>

    <!-- Bootstrap core CSS -->
    <link href="./theme/css/bootstrap.min.css" rel="stylesheet"> 

    <!-- Custom styles for this template -->
    <link href="./theme/css/starter-template.css" rel="stylesheet"> 
    
    <!-- Search CSS -->
    <link rel="stylesheet" href="./theme/tipuesearch/tipuesearch.css"> 
</head>

 <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="./category/code.html">Code</a></li>
                    <li><a href="./category/networking.html">Networking</a></li>
                    <li class="active"><a href="./category/system-administration.html">System Administration</a></li>
          </ul>
<!--                <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
                    <div class="form-group">
                        <input class="form-control" id="searchbox" type="text" name="q" size="12" placeholder="Search">
                    </div>
                </form> -->
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
<body id="index" class="home">
        <header id="banner" class="body">
                <h1 class="header"><a href="./">War Against Computers <strong></strong></a></h1>
        </header><!-- /#banner -->

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./apache-ssl-configuration-snippets.html" rel="bookmark"
         title="Permalink to Apache SSL Configuration Snippets">Apache SSL Configuration Snippets</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2015-03-01T00:00:00-05:00">
      Wed 01 March 2015
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/alex.html">alex</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h2>Certificates, Protocols and Options</h2>
<div class="highlight"><pre>SSLEngine on
SSLCertificateFile /etc/apache2/ssl/cert.pem
SSLCertificateKeyFile /etc/apache2/ssl/cert.pem
SSLCACertificateFile /etc/apache2/ssl/ca-certs.pem
SSLProtocol all -SSLv2 -SSLv3
SSLHonorCipherOrder on          # Ciphers specified by the server take precedence
# Optional, defaults to off
SSLInsecureRenegotiation off    # Mitigates CVE-2009-3555
SSLCompression off              # Mitigates CRIME and BEAST attacks (Apache 2.4 only)
</pre></div>


<h2>Cipher Suites</h2>
<p>See <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_configurations">Mozilla TLS Recommendations</a></p>
<h3>Modern</h3>
<p>This meets Perfect Forward Secrecy standards</p>
<div class="highlight"><pre>SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK

or

SSLCipherSuite AES256+EECDH:AES256+EDH
</pre></div>


<h3>Compatible</h3>
<p>This will achieve a Cipher Strength of 90 from Qualys</p>
<div class="highlight"><pre>SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA

or

SSLCipherSuite HIGH:!MD5:!RC4:!aNULL:!eNULL:!EXP
</pre></div>


<h3>Legacy</h3>
<p>Avoid using where possible</p>
<div class="highlight"><pre>SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
</pre></div>


<h2>HSTS</h2>
<div class="highlight"><pre>Header set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;
</pre></div>


<h2>OCSP Stapling</h2>
<div class="highlight"><pre>SSLStaplingCache shmcb:/tmp/stapling_cache(128000) # place outside <span class="nt">&lt;virtualhost&gt;&lt;/virtualhost&gt;</span>
SSLCACertificateFile /etc/apache2/ssl/ca-certs.pem
SSLUseStapling on
</pre></div>


<h2>So what's all this mean?</h2>
<p>SSL is bad, disable it and use TLS exclusivly ( see wikipedia's listing of <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Security">SSL vulnerabilities</a>) </p>
<p>We want the server, not the client, to mandate the order in which SSL ciphers will be used </p>
<p>HTTP Strict-Transport-Security (<a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a>) is a policy that explicity tells web clients to use the HTTPS version of a resource.  When a webserver redirects a non-HTTP request to an HTTPS version of the same site, HSTS mandates that the webserver includes a <code>Strict-Transport-Security</code> header telling the client to use the secure site.  </p>
<p>Disabling SSL compression mitigates the <a href="https://en.wikipedia.org/wiki/CRIME">CRIME</a> and <a href="http://breachattack.com/">BREACH</a> attacks.  The <code>SSLCompression</code> directive is available in apache &gt;= 2.4.3.  The default setting is off.  </p>
<p>Disabling insecure renegotiation mitigates <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2009-3555">CVE-2009-3555</a>.  The <code>SSLInsecureRenegotiation</code> directive is available in apache &gt;= 2.2.15.  The default setting is off.  </p>
<p>OCSP staping is cool because it lets the webserver verify the certificate revokation status (OCSP/CRL) and relay that information to the client.  This alleviates each client from contacting the OSCP server.  Sweet. </p>
<p>There's a ton of ciphers to choose from when configuring <code>SSLCipherSuite</code> and it can be overwhelming.  There are aliases that can be used (HIGH, MEDIUM, LOW) but the only one that's acceptable to use anymore is HIGH.  Aliases do work, <code>SSLCipherSuite HIGH:!MD5:!RC4:!aNULL:!eNULL:!EXP</code> but for the best control (speed vs. security) explicitly defining ciphers  should be used. </p>
<p>Forward Secrecy ( aka Perfect Forward Secrecy or PFS) is not a setting, but rather it's a standard that's achieved when secure key-exchange ciphers are used.  These secure ciphers are deemed to provide a level of encryption that will prevent future decryption attacks given a reasonable amount of time </p>
<p>There are alot of <code>SSLCipherSuite</code> configurations floating around the Internet.  Alot of these are old and may no longer be the recommended configuration.  Mozilla has an extremely comprehensive <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_configurations">writeup</a> of implementing encryption and the ciphers they recommend using, including use cases for each set. </p>
<h2>So now what?</h2>
<p>Setup your servers and test your configurations using the <a href="https://www.ssllabs.com/ssltest/analyze.html">Qualys SSL Analyzer</a> and <a href="https://sslcheck.globalsign.com/">GlobalSign's SSL Checker</a>.  Remember, only you can prevent shitty encryption on your sites.</p>
<p>Links:</p>
<p><a href="https://wiki.mozilla.org/Security/Server_Side_TLS">Mozilla Server Side TLS</a></p>
<p><a href="https://sslcheck.globalsign.com/">GlobalSign SSL Checker</a></p>
<p><a href="https://www.ssllabs.com/ssltest/">Qualys SSL Analyzer</a></p>
<p><a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html">Strong SSL on Apache</a></p>
<p><a href="https://community.qualys.com/blogs/securitylabs/2013/08/05/configuring-apache-nginx-and-openssl-for-forward-secrecy">Configure Forward Secrecy</a></p>
<p><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security">Strict Transport Security</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-configure-ocsp-stapling-on-apache-and-nginx">Configure OCSP Stapling on Apache and Nginx</a></p>
  </div><!-- /.entry-content -->
</section>
    </div>

<script type="text/javascript">
    var disqus_shortname = 'alexcreekcom';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
        
        <footer id="contentinfo" class="container">
                <address id="about" class="vcard body">
                </br>Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="./theme/js/bootstrap.min.js"></script>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-56063544-1");
pageTracker._trackPageview();
} catch(err) {}</script>

    
</body>
</html>
