<!DOCTYPE html>
<html lang="en">
<head>
          <title>Stuff I Wanna Remember</title>
        <meta charset="utf-8" />
        <link href="alexcreek.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Stuff I Wanna Remember Full Atom Feed" />
        <link href="alexcreek.com/feeds/system-administration.atom.xml" type="application/atom+xml" rel="alternate" title="Stuff I Wanna Remember Categories Atom Feed" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="../../favicon.ico">





    <!-- Google web fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,900' rel='stylesheet' type='text/css'>

    <!-- Bootstrap core CSS -->
    <link href="./theme/css/bootstrap.min.css" rel="stylesheet"> 

    <!-- Custom styles for this template -->
    <link href="./theme/css/starter-template.css" rel="stylesheet"> 
    
    <!-- Search CSS -->
    <link rel="stylesheet" href="./theme/tipuesearch/tipuesearch.css"> 
</head>

 <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="./category/code.html">Code</a></li>
                    <li><a href="./category/networking.html">Networking</a></li>
                    <li class="active"><a href="./category/system-administration.html">System Administration</a></li>
          </ul>
<!--                <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
                    <div class="form-group">
                        <input class="form-control" id="searchbox" type="text" name="q" size="12" placeholder="Search">
                    </div>
                </form> -->
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
<body id="index" class="home">
        <header id="banner" class="body">
                <h1 class="header"><a href="./">Stuff I Wanna Remember <strong></strong></a></h1>
        </header><!-- /#banner -->

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./mysql-cheatsheet.html" rel="bookmark"
         title="Permalink to Mysql Cheatsheet">Mysql Cheatsheet</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-12-15T00:00:00-05:00">
      Mon 15 December 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/alex.html">alex</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h2>Secure Operations</h2>
<h3>Configure securely</h3>
<div class="highlight"><pre>sudo mysql_secure_installation
</pre></div>


<h3>Running securely</h3>
<div class="highlight"><pre>sudo mysqld_safe
</pre></div>


<h2>Managing Users</h2>
<h3>List users</h3>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="k">user</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="k">user</span><span class="p">;</span>
</pre></div>


<h3>Create a user and assign permissions for a database</h3>
<div class="highlight"><pre>GRANT ALL PRIVILEGES ON &lt;database&gt;.* TO &lt;newuser&gt;@&lt;hostname&gt; IDENTIFIED BY &#39;&lt;password&gt;&#39;;
</pre></div>


<h3>Reset a user's password</h3>
<div class="highlight"><pre>SET PASSWORD FOR &#39;&lt;user&gt;&#39;@&#39;&lt;hostname&gt;&#39;=PASSWORD(&#39;&lt;password&gt;&#39;);
</pre></div>


<h3>Update permissions</h3>
<div class="highlight"><pre>FLUSH PRIVILEGES;
</pre></div>


<h2>Managing databases and tables</h2>
<h3>List databases</h3>
<div class="highlight"><pre>SHOW databases;
</pre></div>


<h3>Create a database</h3>
<div class="highlight"><pre>CREATE DATABASE &lt;database&gt;;
</pre></div>


<h3>Select a database to use</h3>
<div class="highlight"><pre>USE &lt;database&gt;;
</pre></div>


<h3>List database tables</h3>
<div class="highlight"><pre>SHOW tables;
</pre></div>


<h3>List field formats</h3>
<div class="highlight"><pre>DESCRIBE &lt;table&gt;;
</pre></div>


<h3>Display data (record)</h3>
<div class="highlight"><pre>SELECT &lt;field&gt; FROM &lt;table&gt;;
</pre></div>


<h3>Delete data</h3>
<div class="highlight"><pre>DELETE FROM &lt;table&gt;;
</pre></div>


<h3>Delete a table</h3>
<div class="highlight"><pre>DROP TABLE &lt;table&gt;;
</pre></div>


<h3>Delete a database</h3>
<div class="highlight"><pre>DROP DATABASE &lt;database&gt;;
</pre></div>


<h2>Disaster Recovery</h2>
<h3>Backup a database</h3>
<div class="highlight"><pre>mysqldump -u &lt;username&gt; -p &lt;db name&gt; &gt; backup.sql
</pre></div>


<h3>Backup multiple databases</h3>
<div class="highlight"><pre><span class="x">for i in </span><span class="p">$(</span><span class="err">mysql</span> <span class="err">-e</span> <span class="s1">&#39;show databases&#39;</span> <span class="err">|</span> <span class="err">egrep</span> <span class="err">-iv</span> <span class="s2">&quot;(database|schema|mysql)&quot;</span><span class="p">)</span><span class="x">; do mysqldump </span><span class="p">$</span><span class="nv">i</span><span class="x"> &gt; </span><span class="p">$</span><span class="nv">i</span><span class="p">.</span><span class="nv">sql</span><span class="x"> ; done</span>
</pre></div>


<h3>Restore a database</h3>
<div class="highlight"><pre>mysql -u &lt;username&gt; -p &lt;db name&gt; &lt; backup.sql
</pre></div>


<h3>Restore multiple databases</h3>
<div class="highlight"><pre><span class="s s-Atom">for</span> <span class="s s-Atom">database</span> <span class="s s-Atom">in</span> <span class="err">$</span><span class="p">(</span><span class="s s-Atom">ls</span> <span class="o">/</span><span class="s s-Atom">backups</span><span class="o">/</span><span class="s s-Atom">databases/</span><span class="p">);</span> <span class="s s-Atom">do</span> <span class="s s-Atom">mysql</span> <span class="o">-</span><span class="s s-Atom">e</span> <span class="s2">&quot;create database ${database:0:-4};&quot;</span><span class="p">;</span> <span class="s s-Atom">mysql</span> <span class="s2">&quot;${database:0:-4}&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;$database&quot;</span><span class="p">;</span> <span class="s s-Atom">done</span>
</pre></div>


<h3>Copy a database (target db must exist)</h3>
<div class="highlight"><pre>mysqldump -u &lt;username&gt; -p &lt;source db&gt; | mysql -u &lt;username&gt; -p &lt;destination db&gt;
</pre></div>


<h3>Recover Mysql root password and set a new password</h3>
<div class="highlight"><pre><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">mysql</span> <span class="n">stop</span>
<span class="n">mysqld_safe</span> <span class="c1">--skip-grant-tables &amp;</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span>
<span class="n">USE</span> <span class="n">mysql</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">USER</span> <span class="k">SET</span> <span class="n">PASSWORD</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">(</span><span class="ss">&quot;newrootpassword&quot;</span><span class="p">)</span> <span class="k">WHERE</span> <span class="k">USER</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
<span class="n">quit</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">mysql</span> <span class="n">stop</span>
<span class="n">mysqld_safe</span>
</pre></div>


<h2>Query Tips</h2>
<h3>Working with time and dates</h3>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="n">NOW</span><span class="p">();</span>
<span class="k">SELECT</span> <span class="n">DATE_ADD</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span> <span class="nb">INTERVAL</span> <span class="mi">30</span> <span class="k">day</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">DATE_SUB</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span> <span class="nb">INTERVAL</span> <span class="mi">30</span> <span class="k">day</span><span class="p">);</span>
<span class="n">SELCET</span> <span class="n">DATEDIFF</span><span class="p">(</span><span class="n">expiration</span><span class="p">,</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">FROM</span> <span class="n">user_accounts</span> <span class="k">WHERE</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
    </div>

<script type="text/javascript">
    var disqus_shortname = 'alexcreekcom';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
        
        <footer id="contentinfo" class="container">
                <address id="about" class="vcard body">
                </br>Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="./theme/js/bootstrap.min.js"></script>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-56063544-1");
pageTracker._trackPageview();
} catch(err) {}</script>

    
</body>
</html>
